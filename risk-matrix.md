# 리스크 매트릭스 (재작성)

## 1. 평가 기준
- **척도**: 높음(3점), 보통(2점), 낮음(1점)
- **평가 항목**:
    - **비즈니스 임팩트**: 기능 실패 시 비즈니스에 미치는 영향의 크기
    - **코드 복잡도**: 기능 구현 코드의 이해, 수정, 테스트의 어려움 (Nesting, 결합도 등)
    - **변경 빈도**: 향후 비즈니스 요구사항 변경으로 코드가 수정될 가능성
    - **버그 가능성**: 코드 스멜, 잘못된 설계로 인해 버그가 존재하거나 발생할 잠재력
- **계산식**: 리스크 점수 = 비즈니스 임팩트 + 코드 복잡도 + 변경 빈도 + 버그 가능성

## 2. 평가 결과

| 기능 | 비즈니스 임팩트 | 코드 복잡도 | 변경 빈도 | 버그 가능성 | 총점 | 순위 |
|:---|:---:|:---:|:---:|:---:|:---:|:---:|
| **프로젝트 검색 & N+1 문제** | 높음(3) | 보통(2) | 높음(3) | 높음(3) | **11** | **1** |
| **멤버 추가 & 동시성 제어** | 높음(3) | 보통(2) | 보통(2) | 높음(3) | **10** | **2** |
| **프로젝트 지원 승인/거절** | 보통(2) | 보통(2) | 높음(3) | 보통(2) | **9** | **3** |
| **인증 & 환경 설정** | 보통(2) | 낮음(1) | 보통(2) | 보통(2) | **7** | **4** |
| **파일 업로드** | 낮음(1) | 낮음(1) | 낮음(1) | 낮음(1) | **4** | **5** |

## 3. 테스트 우선순위 추천

`SYSTEM_ANALYSIS_REPORT.md`의 분석 결과를 바탕으로, 아래 순서에 따라 테스트를 집중하는 것을 추천합니다.

### Priority 1: 프로젝트 검색 성능 최적화 (가장 시급)

- **선정 이유**:
    - **치명적 성능 결함 존재**: 분석 리포트에서 지적된 **"심각한 N+1 문제"**는 페이징 사이즈 20개 기준 한 번의 API 호출에 **61번의 쿼리**가 발생합니다. 이는 사용자가 가장 많이 사용하는 메인 페이지와 직결되어 장애 발생 시 파급력이 가장 큽니다.
    - **데이터 증가에 따른 급격한 성능 저하**: 사용자와 프로젝트 데이터가 쌓일수록 시스템 성능이 급격히 저하될 수 있는 치명적인 병목 지점입니다. 리스크 총점(11점)이 가장 높아 최우선 순위로 해결해야 합니다.
- **필수 테스트 항목**:
    - **성능 테스트 (Before/After)**: 더미 프로젝트 데이터 100개 이상을 생성한 후, 검색 API 호출 시 실행되는 **쿼리 개수를 측정**합니다. Fetch Join, Batch Size 설정, DTO Projection 등으로 쿼리를 최적화한 뒤, 동일한 조건에서 쿼리 수와 응답 시간이 개선되었는지 수치적으로 비교 검증해야 합니다.
    - **시나리오 기반 통합 테스트**: 리팩토링 후, 다양한 필터 조합(카테고리, 기술 스택, 모집 분야)으로 검색 시 결과가 정확히 반환되는지 검증합니다. 페이징 처리가 올바르게 동작하는지도 포함해야 합니다.
    - **부하 테스트**: JMeter 또는 k6를 사용하여 다수의 동시 사용자가 메인 페이지 및 검색 API를 호출하는 시나리오에서 시스템이 안정적으로 응답하는지 검증합니다.

### Priority 2: 멤버 추가 & 동시성 제어

- **선정 이유**:
    - **동시성 처리의 취약점**: `@Retry` 어노테이션을 사용한 낙관적 락 방식은 경합이 적을 때는 유효하지만, 인기 있는 프로젝트에 수십/수백 명의 지원자가 **동시에 몰릴 경우 재시도 횟수를 소진하고 요청이 실패**할 수 있습니다.
    - **데이터 불일치 위험**: `ObjectOptimisticLockingFailureException` 충돌 시 사용자가 정당한 지원 기회를 박탈당하거나, 실제 DB에 반영된 인원 수와 `recruitmentCount`가 일치하지 않을 수 있습니다.
- **필수 테스트 항목**:
    - **동시성/스트레스 테스트**: JMeter 또는 k6를 사용하여 동일 프로젝트에 대해 **50명 이상의 유저가 동시에 '멤버 추가' 또는 '지원 승인' 요청**을 전송합니다. 성공한 인원 수와 실제 DB에 반영된 인원 수가 정확히 일치하는지 검증해야 합니다. (예: `CountDownLatch`, 테스트 컨테이너 활용)
    - **재시도 로직 검증 테스트**: 의도적으로 낙관적 락 충돌을 유발하여 `@Retry` 로직이 예상대로 동작하는지, 최대 재시도 횟수 초과 시 적절한 에러 응답이 반환되는지 검증합니다.
    - **단위 테스트**: 모집 인원 증가 로직(`increaseCurrentCount`)이 모집 정원 초과 시 `RECRUITMENT_FULL` 에러를 정확히 반환하는지 독립적으로 검증합니다.

### Priority 3: 프로젝트 지원 승인/거절 통합 테스트

- **선정 이유**:
    - **긴 트랜잭션 흐름**: 지원 -> 알림 저장 -> 승인 -> 멤버 등록 -> 알림 저장으로 이어지는 **트랜잭션 흐름이 복잡**합니다. 중간에 실패했을 때 데이터(지원서 상태, 알림, 멤버 목록)가 정합성을 유지하는지 확인이 필요합니다.
    - **핵심 비즈니스 로직**: 팀 구성의 핵심 기능으로, 알림 누락이나 상태 불일치는 사용자 경험에 직접적인 영향을 미칩니다.
- **필수 테스트 항목**:
    - **정상 플로우 통합 테스트**: 지원 -> 승인 -> 멤버 등재 확인 -> 알림 발송 확인의 전체 흐름을 검증합니다. 거절 플로우도 동일하게 검증합니다.
    - **예외 케이스 테스트**: 모집 마감 후 승인 시도, 이미 멤버인 경우 지원 시도, 이미 지원한 경우 중복 지원 시도 등 각 예외 상황에서 적절한 에러 코드(`PROJECT_APPLICATION_ALREADY_EXISTS`, `PROJECT_MEMBER_ALREADY_EXISTS`, `RECRUITMENT_FULL`)가 반환되는지 검증합니다.
    - **트랜잭션 롤백 테스트**: 멤버 등록 단계에서 의도적으로 예외를 발생시켜, 지원서 상태와 알림 데이터가 올바르게 롤백되는지 확인합니다.

### Priority 4: 인증 & 환경 설정

- **선정 이유**:
    - **환경 종속성 문제**: 쿠키 생성 로직 등에 도메인 주소(`.meeteam.alom-sejong.com`)가 **하드코딩**되어 있어, 개발/검증/운영 환경별로 배포 시마다 소스 코드를 수정해야 하는 불편함과 실수가 발생할 수 있습니다.
- **필수 테스트 항목**:
    - **환경별 설정 테스트**: `application.yml` 프로파일별(local, staging, production)로 쿠키 도메인 설정이 올바르게 적용되는지 검증합니다.
    - **인증 플로우 통합 테스트**: JWT 발급 -> Access Token 만료 -> Refresh Token 갱신 -> 로그아웃의 전체 인증 사이클이 정상 동작하는지 검증합니다.
    - **OAuth2 테스트**: Google, GitHub 소셜 로그인 플로우가 정상적으로 동작하고, 필수 정보(이메일, Provider ID)가 누락된 경우 적절한 에러 처리가 되는지 검증합니다.

### Priority 5: 파일 업로드

- **선정 이유**:
    - **낮은 복잡도와 리스크**: 외부 라이브러리(AWS S3)를 활용하여 구현되어 있으며, 실패 시 영향 범위가 제한적입니다.
- **필수 테스트 항목**:
    - **유효성 검증 테스트**: 허용되지 않은 확장자 업로드 시 `INVALID_FILE_EXTENSION`, 최대 용량 초과 시 `FILE_SIZE_EXCEEDED` 에러가 반환되는지 검증합니다.
    - **정상 업로드 테스트**: 허용된 이미지 파일 업로드 시 S3 URL이 정상적으로 반환되는지 검증합니다.

---

## 4. 리팩토링 제안 요약

| 순위 | 기능 | 주요 리팩토링 방향 |
|:---:|:---|:---|
| 1 | 프로젝트 검색 | Fetch Join, Batch Size 설정, DTO Projection으로 N+1 문제 해결 |
| 2 | 멤버 추가 | Pessimistic Lock 또는 Redis Atomic Counter로 동시성 제어 강화 |
| 3 | 지원 승인/거절 | 트랜잭션 경계 명확화, 이벤트 기반 알림 처리의 실패 복구 로직 추가 |
| 4 | 인증 | `application.yml`로 도메인 설정 외부화, `@Value` 주입 적용 |
| 5 | 파일 업로드 | 현행 유지 (추가 개선 불필요) |
