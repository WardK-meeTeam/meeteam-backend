# ATDD 테스트 전략

## 1. 현재 상황 분석

### 프로젝트 상태
- 요구사항이 전반적으로 개편되는 상황
- 기존 레거시 기능도 대폭 수정 필요
- 사실상 신규 기능 개발에 가까움

### 기존 테스트 인프라
- Cucumber + RestAssured 기반 인수테스트 구조 존재
- 테스트 도메인: Auth, Project Search, Project Application, File Upload
- 테스트 지원 도구: DatabaseCleaner, EmbeddedRedis, FakeS3Server, FakeOAuthServer

---

## 2. 테스트 전략 원칙


| 상황 | 전략 |
|------|------|
| 기존 기능 보호 필요 없음 | 신규 기능 + 인수테스트를 함께 개발 |
| 서비스 운영 중 (기존 기능 보호 필요) | 기존 기능 인수테스트로 보호 → 신규 기능 테스트 추가 → 리팩터링 |

### 현재 상황에 적용
- 요구사항이 전면 개편되므로 기존 기능 보호보다 **신규 기능 검증**에 집중
- 기존 인수테스트는 유지하되, 요구사항 변경 시 새 인수테스트로 대체

---

## 3. 실행 계획

### Phase 1: 요구사항 분석 및 인수조건 도출
```
1. 변경되는 요구사항 목록 정리
2. 각 요구사항별 인수조건(Acceptance Criteria) 작성
3. 인수조건을 Gherkin 시나리오로 변환
```

### Phase 2: 인수테스트 우선 작성 (ATDD)
```
1. Feature 파일 작성 (시나리오 정의)
2. Step Definition 작성 (실패하는 테스트)
3. API 개발 진행
4. 테스트 통과 확인
```

### Phase 3: 기존 테스트 정리
```
1. 새 인수테스트로 기존 기능이 커버되면 레거시 테스트 제거
2. 중복 테스트 코드 정리
```

---

## 4. 구체적 액션 아이템

### 즉시 해야 할 일

| # | 액션 | 산출물 |
|---|------|--------|
| 1 | 변경되는 요구사항 목록화 | 요구사항 문서 |
| 2 | 요구사항별 인수조건 작성 | 인수조건 체크리스트 |
| 3 | 우선순위 높은 기능부터 Feature 파일 작성 | `*.feature` 파일 |

### Feature 파일 작성 템플릿

기존 프로젝트의 feature 파일 구조를 따릅니다:

```gherkin
# language: ko

@acceptance @도메인명
기능: 기능 설명
  사용자 스토리 형식의 설명

  배경:
    먼저 사전 조건들...

  # ==========================================================================
  # 정상 케이스
  # ==========================================================================

  @happy-path
  시나리오: 정상 케이스 설명
    먼저 ...
    만약 ...
    그러면 ...

  # ==========================================================================
  # 에러 케이스
  # ==========================================================================

  @error-case
  시나리오: 에러 케이스 설명
    먼저 ...
    만약 ...
    그러면 ...

  # ==========================================================================
  # 엣지 케이스
  # ==========================================================================

  @edge-case
  시나리오: 엣지 케이스 설명
    먼저 ...
    만약 ...
    그러면 ...
```

### 기능별 테스트 작성 순서 (권장)

```
1. 핵심 비즈니스 로직 (가장 중요한 기능)
2. 사용자 인증/인가
3. CRUD 기본 기능
4. 에러 핸들링
5. 엣지 케이스
```

---

## 5. 주의사항

### 인수테스트 먼저, API 개발 나중
- Feature 파일 → Step Definition → API 구현 순서 유지
- 실패하는 테스트를 먼저 작성하고, 테스트를 통과시키는 방향으로 개발

### 기존 테스트 즉시 삭제 금지
- 새 인수테스트가 기존 기능을 완전히 대체할 때까지 유지
- 대체 완료 후 정리

### 단위테스트는 필요시 추가
- 인수테스트로 검증 어려운 복잡한 비즈니스 로직
- 유틸리티 클래스, 알고리즘 등

---

## 6. 테스트 피라미드 적용

```
        /\
       /  \      인수테스트 (E2E)
      /----\     - 사용자 관점의 시나리오 검증
     /      \    - API 레벨 테스트
    /--------\
   /          \  통합테스트
  /------------\ - 여러 계층 간 상호작용 검증
 /              \
/----------------\  단위테스트
                   - 개별 클래스/메서드 검증
                   - 복잡한 비즈니스 로직
```

### 현재 전략에서의 우선순위
1. **인수테스트**: 요구사항 검증의 핵심 (ATDD 방식)
2. **단위테스트**: 복잡한 로직에 대해 필요시 추가
3. **통합테스트**: 외부 시스템 연동 검증 시 추가

---

## 7. 요약

```
[현재 상황]
요구사항 전면 개편 → 신규 기능 개발에 가까움

[전략]
ATDD 방식: 인수조건 도출 → 인수테스트 작성 → API 개발

[실행 순서]
1. 요구사항 정리
2. 인수조건 도출
3. Feature 파일 작성
4. Step Definition 작성 (실패)
5. API 개발 (통과)
6. 기존 테스트 정리
```

---

## 참고: 슬랙 대화 요약

> **Q:** 요구사항이 전반적으로 개편되는 상황에서 인수테스트를 먼저 구축하고 API 개발을 진행하려는데 괜찮은 방향인가요?

> **A (류성현):**
> - 새롭게 만들어질 기능을 검증하고 싶다면, 신규 기능을 만드는 과정에서 인수테스트와 함께 만들면 됩니다.
> - 단, 서비스가 운영 중인 경우 기존 기능 보호가 중요할 수 있습니다.
> - 일반적으로는 기존 기능을 먼저 보호하고, 새로운 기능을 검증하는 테스트를 이중으로 만들면서 리팩터링합니다.