# language: ko

@acceptance @application
Feature: 프로젝트 지원 및 팀원 관리
  개발자가 프로젝트에 지원하고, 팀장이 지원을 승인/거절하여 팀을 구성할 수 있어야 한다.

  배경:
    먼저 다음 회원들이 존재한다:
      | 이름    | 역할     |
      | 이영희  | 팀장     |
      | 홍길동  | 지원자   |
      | 김철수  | 지원자   |
    그리고 "이영희"가 만든 "AI 챗봇 개발" 프로젝트가 존재한다
    그리고 백엔드 개발자 모집 정원은 3명이다

  # ==========================================================================
  # 프로젝트 지원 시나리오
  # ==========================================================================

  @apply @happy-path
  시나리오: 개발자가 프로젝트에 지원할 수 있다
    만약 "홍길동"이 "AI 챗봇 개발" 프로젝트에 백엔드 개발자로 지원하면
    그러면 지원에 성공한다
    그리고 "홍길동"의 지원 상태는 "대기중"이다
    그리고 "이영희" 팀장에게 "새로운 지원자가 있습니다" 알림이 발송된다

  @apply @error-case
  시나리오: 이미 지원한 프로젝트에 중복 지원할 수 없다
    먼저 "홍길동"이 이미 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    만약 "홍길동"이 같은 프로젝트에 다시 지원하면
    그러면 지원이 거부된다
    그리고 "이미 지원한 프로젝트입니다" 메시지를 확인한다

  @apply @error-case
  시나리오: 이미 참여중인 프로젝트에 지원할 수 없다
    먼저 "홍길동"이 이미 "AI 챗봇 개발" 프로젝트의 멤버이다
    만약 "홍길동"이 같은 프로젝트에 지원하면
    그러면 지원이 거부된다
    그리고 "이미 참여 중인 프로젝트입니다" 메시지를 확인한다

  @apply @error-case
  시나리오: 완료된 프로젝트에는 지원할 수 없다
    먼저 "AI 챗봇 개발" 프로젝트가 완료된 상태이다
    만약 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원하면
    그러면 지원이 거부된다
    그리고 "이미 완료된 프로젝트입니다" 메시지를 확인한다

  @apply @error-case
  시나리오: 모집 마감된 프로젝트에는 지원할 수 없다
    먼저 "AI 챗봇 개발" 프로젝트의 모집이 마감되었다
    만약 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원하면
    그러면 지원이 거부된다
    그리고 "모집이 마감된 프로젝트입니다" 메시지를 확인한다

  # ==========================================================================
  # 지원 승인 시나리오
  # ==========================================================================

  @approve @happy-path
  시나리오: 팀장이 지원을 승인하면 멤버로 등록된다
    먼저 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    만약 "이영희" 팀장이 "홍길동"의 지원을 승인하면
    그러면 승인에 성공한다
    그리고 "홍길동"이 프로젝트 멤버 목록에 표시된다
    그리고 "홍길동"에게 "지원이 승인되었습니다" 알림이 발송된다
    그리고 백엔드 개발자 현재 인원이 1명으로 증가한다

  @approve @error-case
  시나리오: 모집 정원이 가득 차면 더 이상 승인할 수 없다
    먼저 백엔드 개발자 3명이 이미 승인되어 있다
    그리고 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    만약 "이영희" 팀장이 "홍길동"의 지원을 승인하면
    그러면 승인이 거부된다
    그리고 "모집 정원이 가득 찼습니다" 메시지를 확인한다

  @approve @error-case
  시나리오: 팀장이 아닌 멤버는 지원을 승인할 수 없다
    먼저 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    그리고 "김철수"는 프로젝트의 일반 멤버이다
    만약 "김철수"가 "홍길동"의 지원을 승인하면
    그러면 승인이 거부된다
    그리고 "권한이 없습니다" 메시지를 확인한다

  # ==========================================================================
  # 지원 거절 시나리오
  # ==========================================================================

  @reject @happy-path
  시나리오: 팀장이 지원을 거절할 수 있다
    먼저 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    만약 "이영희" 팀장이 "홍길동"의 지원을 거절하면
    그러면 거절에 성공한다
    그리고 "홍길동"은 프로젝트 멤버 목록에 표시되지 않는다
    그리고 "홍길동"에게 "지원이 거절되었습니다" 알림이 발송된다
    그리고 "홍길동"의 지원 상태가 "거절됨"으로 변경된다

  # ==========================================================================
  # 동시성 제어 시나리오
  # ==========================================================================

  @concurrency @critical
  시나리오: 여러 지원을 동시에 승인해도 정원을 초과하지 않는다
    먼저 50명의 지원자가 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    그리고 백엔드 개발자 모집 정원은 3명이다
    만약 "이영희" 팀장이 50명의 지원을 동시에 승인하면
    그러면 정확히 3명만 승인된다
    그리고 나머지 47명은 "모집 정원이 가득 찼습니다" 메시지를 받는다
    그리고 프로젝트 멤버 목록에는 정확히 3명의 백엔드 개발자가 있다

  @concurrency @edge-case
  시나리오: 승인과 지원이 동시에 발생해도 데이터 정합성이 유지된다
    먼저 백엔드 개발자 2명이 이미 승인되어 있다
    그리고 "홍길동"과 "김철수"가 동시에 지원하고 승인 요청이 발생한다
    만약 두 승인 요청이 동시에 처리되면
    그러면 최대 1명만 추가 승인된다
    그리고 백엔드 개발자 수는 3명을 초과하지 않는다

  # ==========================================================================
  # 지원 취소 시나리오
  # ==========================================================================

  @cancel @happy-path
  시나리오: 지원자가 승인 전에 지원을 취소할 수 있다
    먼저 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원한 상태이다
    그리고 "홍길동"의 지원 상태는 "대기중"이다
    만약 "홍길동"이 지원을 취소하면
    그러면 취소에 성공한다
    그리고 "홍길동"의 지원 내역이 삭제된다

  @cancel @error-case
  시나리오: 이미 승인된 지원은 취소할 수 없다
    먼저 "홍길동"이 "AI 챗봇 개발" 프로젝트에 지원 후 승인된 상태이다
    만약 "홍길동"이 지원을 취소하면
    그러면 취소가 거부된다
    그리고 "이미 승인된 지원은 취소할 수 없습니다" 메시지를 확인한다
