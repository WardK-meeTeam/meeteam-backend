# language: ko
# 희운
@acceptance @applicant
기능: 프로젝트 지원
  회원이 프로젝트에 지원하고, 지원을 취소할 수 있어야 한다.
  프로젝트 리더는 지원을 승인하거나 거절할 수 있어야 한다.

  배경:
    먼저 "홍길동"이 리더인 "AI 뉴스 요약 서비스" 프로젝트가 존재한다
    그리고 다음 포지션이 모집 중이다:
      | 포지션     | 모집 인원 | 현재 인원 |
      | 프론트엔드 | 2명      | 0명      |
      | 디자인     | 1명      | 0명      |

  # ============================================================================
  # 프로젝트 지원
  # ============================================================================

  @apply @happy-path
  시나리오: 회원이 프로젝트에 지원한다
    먼저 "김철수" 회원이 로그인한 상태이다
    만약 "김철수"가 "AI 뉴스 요약 서비스" 프로젝트의 프론트엔드 포지션에 다음 내용으로 지원하면:
      """
      리액트와 타입스크립트를 주로 사용하며,
      사이드 프로젝트 경험을 쌓고 싶어 지원했습니다.
      """
    그러면 지원에 성공한다
    그리고 "김철수"의 지원 상태는 "대기중"이다
    그리고 "홍길동" 리더에게 새로운 지원 알림이 발송된다

  @apply @happy-path
  시나리오: 지원 시 프로필 정보가 자동으로 포함된다
    먼저 "김철수" 회원의 프로필 정보가 다음과 같다:
      | 나이  | 성별 | 이메일              |
      | 28세 | 남성 | kim@example.com    |
    그리고 "김철수" 회원이 로그인한 상태이다
    만약 "김철수"가 프로젝트에 지원하면
    그러면 지원서에 "김철수"의 프로필 정보가 포함된다

  @apply @error-case
  시나리오: 이미 지원한 프로젝트에 중복 지원할 수 없다
    먼저 "김철수" 회원이 로그인한 상태이다
    그리고 "김철수"가 이미 "AI 뉴스 요약 서비스" 프로젝트에 지원한 상태이다
    만약 "김철수"가 같은 프로젝트에 다시 지원하면
    그러면 지원에 실패한다
    그리고 "이미 지원한 프로젝트입니다" 메시지를 확인한다

  @apply @error-case
  시나리오: 이미 참여 중인 프로젝트에 지원할 수 없다
    먼저 "김철수" 회원이 로그인한 상태이다
    그리고 "김철수"가 이미 "AI 뉴스 요약 서비스" 프로젝트의 팀원이다
    만약 "김철수"가 같은 프로젝트의 다른 포지션에 지원하면
    그러면 지원에 실패한다
    그리고 "이미 참여 중인 프로젝트입니다" 메시지를 확인한다

  @apply @error-case
  시나리오: 모집 마감된 프로젝트에 지원할 수 없다
    먼저 "AI 뉴스 요약 서비스" 프로젝트의 모집 상태가 "모집완료"이다
    그리고 "김철수" 회원이 로그인한 상태이다
    만약 "김철수"가 해당 프로젝트에 지원하면
    그러면 지원에 실패한다
    그리고 "모집이 마감된 프로젝트입니다" 메시지를 확인한다

  @apply @auth
  시나리오: 비회원은 프로젝트에 지원할 수 없다
    먼저 로그인하지 않은 상태이다
    만약 프로젝트에 지원하면
    그러면 요청이 거부된다
    그리고 "로그인이 필요합니다" 메시지를 확인한다

  # ============================================================================
  # 지원 취소
  # ============================================================================

#  @cancel @happy-path
#  시나리오: 대기 중인 지원을 취소할 수 있다
#    먼저 "김철수" 회원이 로그인한 상태이다
#    그리고 "김철수"가 "AI 뉴스 요약 서비스" 프로젝트에 지원한 상태이다
#    그리고 지원 상태가 "대기중"이다
#    만약 "김철수"가 지원 취소를 요청하면
#    그러면 지원 취소에 성공한다
#    그리고 "김철수"는 해당 프로젝트에 다시 지원할 수 있다

#  @cancel @error-case
#  시나리오: 이미 승인된 지원은 취소할 수 없다
#    먼저 "김철수" 회원이 로그인한 상태이다
#    그리고 "김철수"의 지원이 승인되어 팀원이 된 상태이다
#    만약 "김철수"가 지원 취소를 요청하면
#    그러면 지원 취소에 실패한다
#    그리고 "이미 승인된 지원은 취소할 수 없습니다" 메시지를 확인한다
#
#  @cancel @error-case
#  시나리오: 이미 거절된 지원은 취소할 수 없다
#    먼저 "김철수" 회원이 로그인한 상태이다
#    그리고 "김철수"의 지원이 거절된 상태이다
#    만약 "김철수"가 지원 취소를 요청하면
#    그러면 지원 취소에 실패한다
#    그리고 "이미 처리된 지원입니다" 메시지를 확인한다

  # ============================================================================
  # 지원 승인
  # ============================================================================

  @approve @happy-path
  시나리오: 리더가 지원을 승인하면 팀원으로 등록된다
    먼저 "김철수"가 "AI 뉴스 요약 서비스" 프로젝트의 프론트엔드 포지션에 지원한 상태이다
    그리고 "홍길동" 리더가 로그인한 상태이다
    만약 "홍길동"이 "김철수"의 지원을 승인하면
    그러면 지원 승인에 성공한다
    그리고 "김철수"가 프로젝트 팀원 목록에 추가된다
    그리고 프론트엔드 포지션 현재 인원이 1명으로 증가한다
    그리고 "김철수"에게 "지원이 승인되었습니다" 알림이 발송된다

  @approve @error-case
  시나리오: 모집 정원이 가득 차면 승인할 수 없다
    먼저 프론트엔드 포지션에 이미 2명이 승인되어 정원이 가득 찬 상태이다
    그리고 "박지민"이 프론트엔드 포지션에 지원한 상태이다
    그리고 "홍길동" 리더가 로그인한 상태이다
    만약 "홍길동"이 "박지민"의 지원을 승인하면
    그러면 지원 승인에 실패한다
    그리고 "모집 정원이 가득 찼습니다" 메시지를 확인한다

  @approve @auth
  시나리오: 리더가 아닌 회원은 지원을 승인할 수 없다
    먼저 "김철수"가 프로젝트에 지원한 상태이다
    그리고 "이영희" 회원이 로그인한 상태이다
    그리고 "이영희"는 프로젝트의 일반 팀원이다
    만약 "이영희"가 "김철수"의 지원을 승인하면
    그러면 지원 승인에 실패한다
    그리고 "권한이 없습니다" 메시지를 확인한다

  # ============================================================================
  # 지원 거절
  # ============================================================================

  @reject @happy-path
  시나리오: 리더가 지원을 거절할 수 있다
    먼저 "김철수"가 "AI 뉴스 요약 서비스" 프로젝트에 지원한 상태이다
    그리고 "홍길동" 리더가 로그인한 상태이다
    만약 "홍길동"이 "김철수"의 지원을 거절하면
    그러면 지원 거절에 성공한다
    그리고 "김철수"의 지원 상태가 "거절됨"으로 변경된다
    그리고 "김철수"에게 "지원이 거절되었습니다" 알림이 발송된다

  @reject @auth
  시나리오: 리더가 아닌 회원은 지원을 거절할 수 없다
    먼저 "김철수"가 프로젝트에 지원한 상태이다
    그리고 "이영희" 회원이 로그인한 상태이다
    그리고 "이영희"는 프로젝트의 일반 팀원이다
    만약 "이영희"가 "김철수"의 지원을 거절하면
    그러면 지원 거절에 실패한다
    그리고 "권한이 없습니다" 메시지를 확인한다

  # ============================================================================
  # 동시성 제어
  # ============================================================================

  @concurrency @critical
  시나리오: 여러 지원을 동시에 승인해도 정원을 초과하지 않는다
    먼저 프론트엔드 포지션 모집 정원이 2명이다
    그리고 50명의 지원자가 프론트엔드 포지션에 지원한 상태이다
    그리고 "홍길동" 리더가 로그인한 상태이다
    만약 "홍길동"이 50명의 지원을 동시에 승인하면
    그러면 정확히 2명만 승인된다
    그리고 나머지 48명은 "모집 정원이 가득 찼습니다" 결과를 받는다
    그리고 팀원 목록에는 정확히 2명의 프론트엔드 개발자가 있다