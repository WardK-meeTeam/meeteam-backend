# ------------------------------------------------------------------------------
# Priority 1: 프로젝트 검색 성능
# 인수 조건: "프로젝트 100개 상태에서 검색 결과가 정상적으로 표시되어야 한다"
# 검증 방법: API 응답 결과 확인
# ------------------------------------------------------------------------------

Feature: 프로젝트 검색 성능
  사용자가 프로젝트를 빠르게 검색할 수 있어야 한다

  Background:
    Given 시스템에 프로젝트가 100개 등록되어 있다

  @acceptance @priority-1
  Scenario: 메인 페이지 프로젝트 목록 조회
    Given 사용자가 메인 페이지에 접속한다
    When 프로젝트 목록을 요청한다
    Then 프로젝트 목록이 정상적으로 표시된다

  @acceptance @priority-1
  Scenario: 필터를 적용한 프로젝트 검색
    Given 사용자가 검색 페이지에 접속한다
    When 카테고리를 "웹 개발"로 선택하고 검색한다
    Then 검색 결과가 정상적으로 표시된다
    And 검색 결과의 모든 프로젝트는 "웹 개발" 카테고리이다

  @acceptance @priority-1
  Scenario: 복합 필터를 적용한 프로젝트 검색
    Given 사용자가 검색 페이지에 접속한다
    When 카테고리를 "웹 개발"로, 기술 스택을 "Spring"으로 선택하고 검색한다
    Then 검색 결과가 정상적으로 표시된다
    And 검색 결과의 모든 프로젝트는 "웹 개발" 카테고리이고 "Spring" 기술 스택을 포함한다

# ------------------------------------------------------------------------------
# Priority 2: 멤버 추가 및 동시성 제어
# 인수 조건: "50명 동시 지원 시에도 모집 정원을 초과 승인하는 일이 없어야 한다"
# 검증 방법: 동시 요청 후 DB 멤버 수 확인
# ------------------------------------------------------------------------------

Feature: 멤버 추가 및 동시성 제어
  여러 사용자가 동시에 지원해도 모집 정원이 초과되지 않아야 한다

  Background:
    Given "AI 챗봇 개발" 프로젝트가 존재한다
    And 백엔드 개발자 모집 정원은 3명이다
    And 현재 승인된 백엔드 개발자는 0명이다

  @acceptance @concurrency @priority-2
  Scenario: 동시 지원 시 정원 초과 방지
    Given 50명의 사용자가 백엔드 개발자로 지원한다
    When 팀장이 50명의 지원을 동시에 승인 시도한다
    Then 정확히 3명만 승인된다
    And 나머지 47명은 "모집 정원이 가득 찼습니다" 메시지를 받는다
    And 프로젝트 멤버 목록에는 정확히 3명의 백엔드 개발자가 있다

  @acceptance @priority-2
  Scenario: 정상적인 멤버 추가
    Given 홍길동이 백엔드 개발자로 지원한다
    When 팀장이 홍길동의 지원을 승인한다
    Then 홍길동이 프로젝트 멤버 목록에 추가된다
    And 백엔드 개발자 현재 인원이 1명으로 증가한다

  @acceptance @priority-2
  Scenario: 모집 정원 초과 방지
    Given 백엔드 개발자 3명이 이미 승인되어 있다
    When 팀장이 김철수의 지원을 승인 시도한다
    Then 승인이 거부된다
    And "모집 정원이 가득 찼습니다" 메시지를 받는다

  @acceptance @priority-2
  Scenario: 중복 지원 방지
    Given 홍길동이 이미 백엔드 개발자로 지원한 상태이다
    When 홍길동이 같은 프로젝트에 다시 지원 시도한다
    Then 지원이 거부된다
    And "이미 지원한 프로젝트입니다" 메시지를 받는다

  @acceptance @priority-2
  Scenario: 기존 멤버의 중복 지원 방지
    Given 홍길동이 이미 프로젝트의 멤버이다
    When 홍길동이 같은 프로젝트에 지원 시도한다
    Then 지원이 거부된다
    And "이미 참여 중인 프로젝트입니다" 메시지를 받는다

# ------------------------------------------------------------------------------
# Priority 3: 프로젝트 지원 승인 및 거절
# 인수 조건: "승인 즉시 멤버 목록에 표시되고 알림이 발송되어야 한다"
# 검증 방법: 멤버 목록 API + 알림 API 응답 확인
# ------------------------------------------------------------------------------

Feature: 프로젝트 지원 승인 및 거절
  팀장이 지원을 승인하면 즉시 멤버로 등록되고 알림이 발송되어야 한다

  Background:
    Given "AI 챗봇 개발" 프로젝트가 존재한다
    And 이영희가 팀장이다
    And 홍길동이 백엔드 개발자로 지원한 상태이다

  @acceptance @priority-3
  Scenario: 지원 승인 시 멤버 등록 및 알림 발송
    When 이영희가 홍길동의 지원을 승인한다
    Then 홍길동이 프로젝트 멤버 목록에 즉시 표시된다
    And 홍길동에게 "지원이 승인되었습니다" 알림이 발송된다
    And 홍길동의 지원 상태가 "승인됨"으로 변경된다

  @acceptance @priority-3
  Scenario: 지원 거절 시 알림 발송
    When 이영희가 홍길동의 지원을 거절한다
    Then 홍길동은 프로젝트 멤버 목록에 표시되지 않는다
    And 홍길동에게 "지원이 거절되었습니다" 알림이 발송된다
    And 홍길동의 지원 상태가 "거절됨"으로 변경된다

  @acceptance @priority-3
  Scenario: 완료된 프로젝트에 대한 지원 불가
    Given "AI 챗봇 개발" 프로젝트가 완료 상태이다
    When 김철수가 프로젝트에 지원 시도한다
    Then 지원이 거부된다
    And "이미 완료된 프로젝트입니다" 메시지를 받는다

  @acceptance @priority-3
  Scenario: 팀장이 아닌 사용자의 승인 시도
    Given 김철수는 프로젝트의 일반 멤버이다
    When 김철수가 홍길동의 지원을 승인 시도한다
    Then 승인이 거부된다
    And "권한이 없습니다" 메시지를 받는다

# ------------------------------------------------------------------------------
# Priority 5: 파일 업로드
# 인수 조건: "허용되지 않은 파일 업로드 시 명확한 에러 메시지가 표시되어야 한다"
# 검증 방법: API 에러 응답 메시지 확인
# ------------------------------------------------------------------------------

Feature: 파일 업로드
  허용되지 않은 파일 업로드 시 명확한 에러 메시지가 표시되어야 한다

  @acceptance @priority-5
  Scenario: 허용되지 않은 확장자 업로드 거부
    Given 사용자가 프로필 편집 페이지에 있다
    When "malware.exe" 파일을 업로드 시도한다
    Then 업로드가 거부된다
    And "지원하지 않는 파일 형식입니다" 메시지를 받는다

  @acceptance @priority-5
  Scenario: 압축 파일 업로드 거부
    Given 사용자가 프로젝트 생성 페이지에 있다
    When "project.zip" 파일을 업로드 시도한다
    Then 업로드가 거부된다
    And "지원하지 않는 파일 형식입니다" 메시지를 받는다

  @acceptance @priority-5
  Scenario: 파일 용량 초과 업로드 거부
    Given 사용자가 프로필 편집 페이지에 있다
    And 최대 허용 용량은 5MB이다
    When 10MB 크기의 "large_image.jpg" 파일을 업로드 시도한다
    Then 업로드가 거부된다
    And "파일 크기가 너무 큽니다 (최대 5MB)" 메시지를 받는다

  @acceptance @priority-5
  Scenario: 정상적인 이미지 업로드
    Given 사용자가 프로필 편집 페이지에 있다
    When "profile.jpg" 파일을 업로드한다
    Then 업로드가 성공한다
    And 프로필 이미지가 변경된다

  @acceptance @priority-5
  Scenario: PNG 이미지 업로드
    Given 사용자가 프로젝트 생성 페이지에 있다
    When "project_thumbnail.png" 파일을 업로드한다
    Then 업로드가 성공한다
    And 프로젝트 썸네일이 설정된다
